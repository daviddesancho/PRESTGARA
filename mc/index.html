<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Monte Carlo - PREST GARA Introduction to molecular simulation techniques</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PREST GARA Introduction to molecular simulation techniques</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="..">Index</a>
                
            </li>
        

    
        
            <li class="toctree-l1 current">
                <a class="current" href="./">Monte Carlo</a>
                
                    <ul>
                    
                        <li class="toctree-l3"><a href="#monte-carlo-simulation-of-an-ising-model">Monte Carlo simulation of an Ising model</a></li>
                        
                            <li><a class="toctree-l4" href="#moving-around">Moving around</a></li>
                        
                            <li><a class="toctree-l4" href="#generating-an-ising-model">Generating an Ising model</a></li>
                        
                            <li><a class="toctree-l4" href="#the-mc-algorithm">The MC algorithm</a></li>
                        
                            <li><a class="toctree-l4" href="#the-metropolis-acceptance-criterion">The Metropolis acceptance criterion</a></li>
                        
                            <li><a class="toctree-l4" href="#exploring-thermal-effects-in-the-algorithm">Exploring thermal effects in the algorithm</a></li>
                        
                    
                    </ul>
                
            </li>
        

    
        
            <li class="toctree-l1 ">
                <a class="" href="../md_protein/">Molecular dynamics</a>
                
            </li>
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PREST GARA Introduction to molecular simulation techniques</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
    <li>Monte Carlo</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h1 id="monte-carlo-simulation-of-an-ising-model">Monte Carlo simulation of an Ising model</h1>
<p>The <a href="https://en.wikipedia.org/wiki/Ising_model">Ising model</a> is very useful 
for the study of magnetization and also for exploring some basic features of
 the Monte Carlo method. </p>
<p>In the Ising model we consider a two-dimensional 
lattice of spins, each of which has only two possible configurations, "up" and 
"down". In our particular example we will consider that interactions are 
limited to nearest neighbours. In the case of a ferromagnet, a parallel pair 
results in a lower energy than an antiparallel pair, while for an antiferromagnet
things work the other way around. Ideally, we would also consider the effect 
of an external field on the results, but today we will focus on the effects 
of temperature only in a ferromagnetic 2D material.</p>
<p>For this exercise we use the code developed by Frans Pretorius and William 
East (Princeton 
University). The first thing we need to do is download two pieces of Python 
code: 
<a href="https://github.com/daviddesancho/PRESTGARA/blob/master/code/Ising_2d/ising_MHMC.py"><code>ising_MHMC.py</code></a> 
and <a href="https://github.com/daviddesancho/PRESTGARA/blob/master/code/Ising_2d/ising.py"><code>ising.py</code></a>. For downloading the files, you will need to click on the "Raw"
tab and then proceed with the download.</p>
<h3 id="moving-around">Moving around</h3>
<p>We will first start developing some intuition on what the code can do. 
The files you downloaded are probably in your <code>Downloads</code> folder, so 
in your terminal please type the following:</p>
<pre><code>$&gt; mkdir Ising
$&gt; cd Ising
$&gt; mv ../Downloads/ising* .
</code></pre>
<p>In a text editor we will open the <code>ising.py</code> file. You can use your favourite
text editor (a good one you will find in your macOS or Linux is called "nano").</p>
<pre><code>$&gt; nano ising.py
</code></pre>
<p>Now we can read the Python code we will be using, although you do not need
to worry about the syntax. At first side you will see that the 
<code>ising.py</code> file contains something called a "class", which we 
define in the statement </p>
<pre><code>class Ising_lattice(object):
</code></pre>
<p>This class allows generating 2D Ising models of size NxN. Although you do not 
need to understand everything in will be useful to go through the following 
snippet:</p>
<pre><code>def __init__(self,N,J=1.0,H=0.0):
   self._N=N
   self._J=J
   self._H=H
   #self.aligned_spins()
   self.random_spins()
   self._compute_E_M()
</code></pre>
<p>What you read above is called a "method", a part of a class which in this case
initializes an instance of the <code>Ising_lattice</code> class. The information it 
needs to get from the user is the size of the lattice (<code>N</code>),  the strength
 of the interactions (<code>J</code>) and the external magnetization (<code>H</code>). Also,
 we are initializing the lattice by randomizing the spin directions (using the
 method <code>random_spins()</code>) and computing the energies and magnetization 
(<code>_compute_E_M()</code>).</p>
<h3 id="generating-an-ising-model">Generating an Ising model</h3>
<p>Let's then initialize an instance of this class in our jupyter-notebook. 
To work with this class we will work on a <a href="http://jupyter.org/">jupyter-notebook</a>.
Assuming that the <code>jupyter</code> package is properly installed in your anaconda 
Python installation, you just have to open your terminal and move to the directory
 where your files are located. There, type the following</p>
<pre><code>$&gt; jupyter-notebook
</code></pre>
<p>This should open a page of your web browser and offer you the possibility 
to create a new notebook using the <code>New</code> tab.  In your newly created 
notebook we will first import a number of packages, for which we will need
to writing and execute the following lines</p>
<pre><code>import os
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline
import ising as I
</code></pre>
<p>For these actions to take place we need to "run" the cell. To do it, we just 
need to either click <code>Shift+Enter</code> or use the Play button on the top bar. 
Next, we can generate an instance of the class with size <em>N=</em>5.</p>
<pre><code>a = I.Ising_lattice(5)
</code></pre>
<p>This generates a 5x5 lattice with randomized spins. To get a simple 
visualization of this you can use another method included in the class.</p>
<pre><code>a.diagram()
</code></pre>
<p>This should result in output like the following </p>
<pre><code>Lattice properties: 5^2 cells, E=-2.000000, M=-1, &lt;E&gt;=-0.0200000, &lt;M&gt;=-0.040000

[['@' ' ' ' ' ' ' '@']
 [' ' ' ' ' ' ' ' '@']
 ['@' '@' '@' ' ' '@']
 ['@' ' ' ' ' ' ' '@']
 ['@' '@' ' ' '@' ' ']]
</code></pre>
<p>In this way we get a rough representation of your magnet, with different symbols
corresponding to up and down spins. We also get the value for the energy, which 
will be useful later. If you want to flip a specific spin then you can use another 
method for that:</p>
<pre><code>a.spin_flip(0,1)
a.diagram()
</code></pre>
<p>And you will get an output corresponding to the flipped spin</p>
<pre><code>[['@' '@' ' ' ' ' '@']
 [' ' ' ' ' ' ' ' '@']
 ['@' '@' '@' ' ' '@']
 ['@' ' ' ' ' ' ' '@']
 ['@' '@' ' ' '@' ' ']]
</code></pre>
<p>Depending of your specific case, the energy in your lattice may have changed
so that you have a more or less stable configuration.</p>
<h3 id="the-mc-algorithm">The MC algorithm</h3>
<p>So far we know how to generate an Ising lattice, flip its spins and recover
 its energy and magnetization. But the configurations we are generating
would be, in principle, as representative of the magnet as any other 
configuration (out of 2<sup>25 </sup>possible options!). Clearly, generating
configurations at random does not seem to be a very good way of understanding
average properties of the system, like the magnetization at a given temperature.
In order to get a more faithful representation we need to sample from the ensemble
of possible configurations. This is done using the Monte Carlo method.</p>
<p>We will run our MC algorithm in the Jupyter notebook. First we will define 
the size of the lattice and generate the initial configuration, in
 this case will be of size 20x20.  </p>
<pre><code>N = 20
a = I.Ising_lattice(N)
</code></pre>
<p>Next we will define the MC loop, which in this case will do 1000 iterations 
trying to sample from the ensemble of possibilities </p>
<pre><code>nflips = 1000
n = 0
temp = 0
energy = []
magnet = []
while n &lt; nflips:
   i = int(np.random.random()*N)
   j = int(np.random.random()*N)
   a.cond_spin_flip(i,j,temp);
   energy.append(a._E)
   magnet.append(a._M)
   n+=1
</code></pre>
<p>In each MC iteration we are attempting a random flip in our lattice. 
The change is done in positions <code>i</code> and <code>j</code> and acceptance or 
rejection of the move depends on the Metropolis criterion. We can plot
the results very easily typing and running the following lines</p>
<pre><code>fig, ax = plt.subplots(2,1, sharex=True)
ax[0].plot(energy)
ax[1].plot(magnet)
ax[1].set_xlabel('MC step')
ax[0].set_ylabel('Energy')
ax[1].set_ylabel('Magnetization')
</code></pre>
<p>What are the trends you observe? Is that the behaviour you would expect
from an MC algorithm? </p>
<h3 id="the-metropolis-acceptance-criterion">The Metropolis acceptance criterion</h3>
<p>The flipping, the calculation of the energy and the acceptance or rejection
 are encoded in the <code>cond_spin_flip()</code> method of the <code>Ising_lattice</code>
 class. The latter part (i.e. the Metropolis rule) deserves some more 
attention. It is encoded in the following line:</p>
<pre><code> if (dE &lt; 0.0 or (T&gt;0.0 and (np.random.random()&lt;np.exp(-dE/T)))):
</code></pre>
<p>This line is asking whether any of two conditions are being fulfilled: 
whether the change in the energy is favourable, or whether being unfavourable
it is permisible given the available thermal energy. In case any of these is
true, the attempted move will be accepted. Otherwise it will be rejected.</p>
<p>Based on this explanation, do the results you have obtained before make sense?</p>
<h3 id="exploring-thermal-effects-in-the-algorithm">Exploring thermal effects in the algorithm</h3>
<p>To finalize with our investigation of the Ising model we are going to explore 
what the thermal effects are in our magnet. For that we will run the algorithm
at different final temperatures. Type the following lines in a Jupyter cell</p>
<pre><code>command = "convert -delay 1 -size 100x100"
temp = 1
H = 0
fout = open("output_T%g_H%g.dat"%(temp,H),"w")
n = 0
k = 0
nflips = 10000
while n &lt; nflips:
    i = int(np.random.random()*N)
    j = int(np.random.random()*N)
    a.cond_spin_flip(i,j,temp)

    if n % 1000 == 0:
        fout.write ("%8i %8i %8i %8i\n"%(n,a._E,a._M,abs(a._M)))
    if n % 1000 == 0:
        k +=1
        try: 
            a.plot(k)
        except IOError:
            os.mkdir("pngs")
        command += " pngs/ising%g.png"%k
    n+=1


command +=" animation_T%g_H%g.gif"%(temp,H)
os.system(command)
fout.close()
</code></pre>
<p>You will see that here we have some additional complexity. On one hand 
there are some mysterious <code>command</code> statements. They are there to allow
for us to create a small animated gif with the time evolution of our Ising 
model at different temperatures. </p>
<p>After running these lines at different temperatures by varying the final 
temperature (<code>temp</code>) do the results make sense? Do they give a hint
of why there is such thing as a <a href="https://en.wikipedia.org/wiki/Curie_temperature">Curie temperature</a>?</p>
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../md_protein/" class="btn btn-neutral float-right" title="Molecular dynamics"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Index"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../md_protein/" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>

<!--
MkDocs version  : 0.12.2
Docs Build Date : 2017-11-28 10:40:55.574893
-->
</body>
</html>